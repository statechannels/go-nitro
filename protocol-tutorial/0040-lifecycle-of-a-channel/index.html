
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../assets/favicon.ico">
      <meta name="generator" content="mkdocs-1.4.1, mkdocs-material-8.5.6">
    
    
      
        <title>Lifecycle of a state channel - Nitro State Channel Framework</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.20d9efc8.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.cbb835fc.min.css">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="statechannels.org" data-md-color-primary="" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#lifecycle-of-a-state-channel" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Nitro State Channel Framework" class="md-header__button md-logo" aria-label="Nitro State Channel Framework" data-md-component="logo">
      
  <img src="../../assets/mstile-144x144.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Nitro State Channel Framework
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Lifecycle of a state channel
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/statechannels/go-nitro" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../.." class="md-tabs__link">
      Nitro Channels
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../faqs/" class="md-tabs__link">
      FAQs
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../research-papers/" class="md-tabs__link">
      Research papers
    </a>
  </li>

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../applications/0010-filecoin/" class="md-tabs__link">
        Applications
      </a>
    </li>
  

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../0010-states-channels/" class="md-tabs__link md-tabs__link--active">
        Protocol tutorial
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Nitro State Channel Framework" class="md-nav__button md-logo" aria-label="Nitro State Channel Framework" data-md-component="logo">
      
  <img src="../../assets/mstile-144x144.png" alt="logo">

    </a>
    Nitro State Channel Framework
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/statechannels/go-nitro" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Nitro Channels
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../faqs/" class="md-nav__link">
        FAQs
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../research-papers/" class="md-nav__link">
        Research papers
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Applications
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Applications" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Applications
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../applications/0010-filecoin/" class="md-nav__link">
        Filecoin
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../applications/0020-web3torrent/" class="md-nav__link">
        Web3Torrent
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../applications/0030-others/" class="md-nav__link">
        Others
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          Protocol tutorial
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Protocol tutorial" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Protocol tutorial
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../0010-states-channels/" class="md-nav__link">
        States & Channels
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../0020-execution-rules/" class="md-nav__link">
        Execution Rules
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../0030-outcomes/" class="md-nav__link">
        Outcomes
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Lifecycle of a state channel
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Lifecycle of a state channel
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#off-chain-lifecycle" class="md-nav__link">
    Off-chain lifecycle
  </a>
  
    <nav class="md-nav" aria-label="Off-chain lifecycle">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#proposed" class="md-nav__link">
    Proposed
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#readytofund" class="md-nav__link">
    ReadyToFund
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#funded" class="md-nav__link">
    Funded
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running" class="md-nav__link">
    Running
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#finalized" class="md-nav__link">
    Finalized
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funding-lifecycle" class="md-nav__link">
    Funding lifecycle
  </a>
  
    <nav class="md-nav" aria-label="Funding lifecycle">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#on-chain" class="md-nav__link">
    On-chain
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#off-chain" class="md-nav__link">
    Off-chain
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adjudication-lifecyle" class="md-nav__link">
    Adjudication lifecyle
  </a>
  
    <nav class="md-nav" aria-label="Adjudication lifecyle">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#channel-modes" class="md-nav__link">
    Channel Modes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#finalizesat" class="md-nav__link">
    finalizesAt
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#turnnumrecord" class="md-nav__link">
    turnNumRecord
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fingerprint" class="md-nav__link">
    fingerprint
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adjudicator-storage" class="md-nav__link">
    Adjudicator storage
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../0050-precautions-and-limits/" class="md-nav__link">
        Precautions and Limits
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../0060-funding-a-channel/" class="md-nav__link">
        Funding a channel
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../0070-finalizing-a-channel/" class="md-nav__link">
        Finalizing a channel
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../0080-defunding-a-channel/" class="md-nav__link">
        Defunding a channel
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#off-chain-lifecycle" class="md-nav__link">
    Off-chain lifecycle
  </a>
  
    <nav class="md-nav" aria-label="Off-chain lifecycle">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#proposed" class="md-nav__link">
    Proposed
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#readytofund" class="md-nav__link">
    ReadyToFund
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#funded" class="md-nav__link">
    Funded
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running" class="md-nav__link">
    Running
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#finalized" class="md-nav__link">
    Finalized
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#funding-lifecycle" class="md-nav__link">
    Funding lifecycle
  </a>
  
    <nav class="md-nav" aria-label="Funding lifecycle">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#on-chain" class="md-nav__link">
    On-chain
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#off-chain" class="md-nav__link">
    Off-chain
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adjudication-lifecyle" class="md-nav__link">
    Adjudication lifecyle
  </a>
  
    <nav class="md-nav" aria-label="Adjudication lifecyle">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#channel-modes" class="md-nav__link">
    Channel Modes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#finalizesat" class="md-nav__link">
    finalizesAt
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#turnnumrecord" class="md-nav__link">
    turnNumRecord
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fingerprint" class="md-nav__link">
    fingerprint
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adjudicator-storage" class="md-nav__link">
    Adjudicator storage
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  <a href="https://github.com/statechannels/go-nitro/edit/master/docs/protocol-tutorial/0040-lifecycle-of-a-channel.md" title="Edit this page" class="md-content__button md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>


<h1 id="lifecycle-of-a-state-channel">Lifecycle of a state channel</h1>
<p>In this section we'll consider the "state" of a state channel as composite of three states -- the <a href="#off-chain-lifecycle"><em>off chain state</em></a>, the on chain <a href="#adjudication"><em>adjudication state</em></a> and the <a href="#funding-lifecyle"><em>funding state</em></a> (which can be on or off chain). The off chain parts of the state may be different for each participant in the channel, whereas the on chain part of the state is considered consistent (up to issues to do with finality and chain reorgs).</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>"State" is a highly overloaded term -- in this section we take it to mean something different from the "state" of <a href="../0010-states-channels/#states">the section on states</a> (unless explicitly noted).</p>
</div>
<h2 id="off-chain-lifecycle">Off-chain lifecycle</h2>
<p>The off-chain lifecycle of a channel may be visualized like this:</p>
<pre class="mermaid"><code>stateDiagram-v2

state OffChain {
[*] --&gt; Proposed
 Proposed --&gt; ReadyToFund
 ReadyToFund --&gt; Funded
 Funded --&gt; Running
 Running --&gt; Finalized
}
</code></pre>
<p>The conditions for each state emerge from the collection of <a href="../0010-states-channels/#states">states</a> and <a href="../0010-states-channels/#state-commitments">signatures</a> held by each participant. Let's look at each in turn.</p>
<h3 id="proposed"><code>Proposed</code></h3>
<p>This state applies as soon as a participant commits to a state with <code>turnNum=0</code> known as the <strong>prefund</strong> state. This is typically broadcast to other participants who may countersign it to indicate their agreement to join the channel.</p>
<h3 id="readytofund"><code>ReadyToFund</code></h3>
<p>This state applies when all participants commit to the <strong>prefund</strong> state, i.e. when all prefund signatures are in hand.</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>It is important to wait for a supported prefund before depositing any funds on chain, since this state is a guarantee that on chain funds can be unlocked with the intial (prefund) <a href="../0030-outcomes/">outcome</a>.</p>
</div>
<h3 id="funded"><code>Funded</code></h3>
<p>This state applies when all participants commit to a state with <code>turnNum=1</code> known as the <strong>postfund</strong> state. Each participant should only make this commitment when one of the following is true:</p>
<ul>
<li>sufficient deposits are accrued on chain against the channel in question</li>
<li>sufficient money is directly allocated to the channel in question from an existing funded channel</li>
<li>sufficient money is <em>guaranteed</em> to the channel in question from an existing funded channel</li>
</ul>
<p>For more detail see the section on <a href="../0060-funding-a-channel/">funding</a>.</p>
<h3 id="running"><code>Running</code></h3>
<p>This state applies when a state with <code>turnNum &gt; 1</code> becomes supported.</p>
<h3 id="finalized"><code>Finalized</code></h3>
<p>This state applies when all participants commit to a state with <code>isFinal=true</code>, i.e. when all final signatures are in hand.</p>
<div class="admonition info">
<p class="admonition-title">Info<p>Each state supercedes the previous ones in the sense that (for example) a channel is said to be <code>Funded</code> if it meets that condition, even though it also meets the condition for <code>ReadyToFund</code>.</p>
</p>
</div>
<h2 id="funding-lifecycle">Funding lifecycle</h2>
<p>A channel may be funded <em>either</em> on-chain or off-chain.</p>
<p>The state can be visualized like this:</p>
<pre class="mermaid"><code>stateDiagram-v2


state OnChain {
state Funding {
    [*]--&gt;NotFundedOnChain
    NotFundedOnChain --&gt; FundedOnChain
    FundedOnChain --&gt; NotFundedOnChain
}
}
state OffChain {
state Fundings {
    [*]--&gt;NotFundedOffChain
    NotFundedOffChain --&gt; FundedOffChain
    FundedOffChain --&gt; NotFundedOffChain
}
}
</code></pre>
<p>The channel should be funded when the off chain state is <code>ReadyToFund</code>, and defunded when the off chain state is <code>Finalized</code>.</p>
<h3 id="on-chain">On-chain</h3>
<p>When a channel is to be funded on chain, participants follow the <a href="../0060-funding-a-channel/#fund-with-an-on-chain-deposit">on chain deposit protocol</a>. When sufficient funds are deposited against the channel, the state has transitioned to <code>FundedOnChain</code>.</p>
<h3 id="off-chain">Off-chain</h3>
<p>Funding on chain is often not necessary, since most channels are funded off-chain. In that case, the "funding state" of a channel is composed of the off-chain state of one or more other channels. See the section on <a href="../0060-funding-a-channel/#fund-from-an-existing-channel">funding</a>.</p>
<h2 id="adjudication-lifecyle">Adjudication lifecyle</h2>
<p>The adjudicator smart contract (henceforth "adjudicator") is the main on-chain code governing the state channel network. It stores certain information about any channel that it knows about. The off chain state may be submitted to the adjudicator at any time to trigger the adjudication status of a channel to change. The adjudication status of a channel is composed of several variables, but these are summarized in finite states <code>Open</code>, <code>Challenge</code> and <code>Finalized</code> -- these are called <a href="#channel-modes">channel modes</a>.</p>
<h3 id="channel-modes">Channel Modes</h3>
<p>A channel is in one or the other of three modes, which can be represented in the following state machine:</p>
<pre class="mermaid"><code>stateDiagram-v2

state OnChain {
state Adjudication {
Open --&gt;Challenge: challenge
Open --&gt; Open: checkpoint
Open--&gt; Finalized: conclude
Challenge--&gt; Challenge: challenge
Challenge--&gt; Open: respond
Challenge--&gt; Open: checkpoint
Challenge--&gt; Finalized: conclude
Challenge--&gt; Finalized': timeout
}
}</code></pre>
<p>Here <code>Finalized</code> and <code>Finalized'</code> are distinct states reflecting the fact that the on-chain storage is slightly different in each case, although the implications are the same (the channel may now be defunded on chain).</p>
<p>Most of the transitions between states can be understood via the section on <a href="../0070-finalizing-a-channel/">finalizing a channel</a>. The remaining transition <code>timeout</code> is a passive transition which happens when a block is produced with a sufficiently large timestamp.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Ideally channels are never adjudicated on chain. This only state applies  as a <a href="../0070-finalizing-a-channel/#sad-path">last resort</a> when cooperation has broken down.</p>
</div>
<p>The channel mode is derived from other <a href="#adjudicator-status">status</a> data stored on chain using this function:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="w">    </span><span class="cm">/**</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="cm">     * @notice Computes the ChannelMode for a given channelId.</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="cm">     * @dev Computes the ChannelMode for a given channelId.</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="cm">     * @param channelId Unique identifier for a channel.</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="cm">     */</span><span class="w"></span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="w">    </span><span class="kt">function</span><span class="w"> </span><span class="nv">_mode</span><span class="p">(</span><span class="kt">bytes32</span><span class="w"> </span><span class="nv">channelId</span><span class="p">)</span><span class="w"> </span><span class="kt">internal</span><span class="w"> </span>view<span class="w"> </span><span class="kt">returns</span><span class="w"> </span><span class="p">(</span>ChannelMode<span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="w">        </span><span class="c1">// Note that _unpackStatus(someRandomChannelId) returns (0,0,0), which is</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="w">        </span><span class="c1">// correct when nobody has written to storage yet.</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="w">        </span><span class="p">(,</span><span class="w"> </span><span class="kt">uint48</span><span class="w"> </span><span class="nv">finalizesAt</span><span class="p">,</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>_unpackStatus<span class="p">(</span>channelId<span class="p">);</span><span class="w"></span>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="w">        </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>finalizesAt<span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m m-Decimal">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="w">            </span><span class="kt">return</span><span class="w"> </span>ChannelMode<span class="p">.</span>Open<span class="p">;</span><span class="w"></span>
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="w">            </span><span class="c1">// solhint-disable-next-line not-rely-on-time</span>
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="kt">else</span><span class="w"> </span><span class="kt">if</span><span class="w"> </span><span class="p">(</span>finalizesAt<span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="k">block.timestamp</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a><span class="w">            </span><span class="kt">return</span><span class="w"> </span>ChannelMode<span class="p">.</span>Finalized<span class="p">;</span><span class="w"></span>
<a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="kt">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a><span class="w">            </span><span class="kt">return</span><span class="w"> </span>ChannelMode<span class="p">.</span>Challenge<span class="p">;</span><span class="w"></span>
<a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a><span class="w">        </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a><span class="w">    </span><span class="p">}</span><span class="w"></span>
</code></pre></div>
<h3 id="finalizesat"><code>finalizesAt</code></h3>
<p>As you can see, the channel mode is determined by the relation between the timestamp of the current block and the <code>finalizesAt</code> timestamp stored on chain. When <code>finalizesAt</code> is in the past, the channel is <code>Finalized</code>; when it is in the future, the channel is in <code>Challenge</code>. When it is (the magic and initial value of ) <code>0</code>, the channel is <code>Open</code>.</p>
<h3 id="turnnumrecord"><code>turnNumRecord</code></h3>
<p><code>turNumRecord</code> is the highest turn number that is known to the chain to be supported by a full set of signatures.
The exception to this rule is that it is set to <code>0</code> when the channel is concluded via a <code>conclude</code> call.</p>
<p>For example, the <code>turnNumRecord</code> might be increased by a submitted <a href="../0070-finalizing-a-channel/#call-checkpoint"><code>checkpoint</code> transaction</a> including a <a href="../0020-execution-rules/#execution-rules">support proof</a> for a state.</p>
<h3 id="fingerprint"><code>fingerprint</code></h3>
<p>The <code>fingerprint</code> helps to uniquely identify the channel's current state, up to hash collisions. It is computed as:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="kt">uint160</span><span class="p">(</span><span class="w"></span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="w">        </span><span class="kt">uint256</span><span class="p">(</span><span class="w"></span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="w">            </span><span class="nb">keccak256</span><span class="p">(</span><span class="w"></span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="w">                </span>abi<span class="p">.</span>encode<span class="p">(</span><span class="w"></span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="w">                    </span>stateHash<span class="p">,</span><span class="w">  </span><span class="c1">// (1)</span>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="w">                    </span>outcomeHash<span class="w"> </span><span class="c1">// (2)</span>
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="w">                </span><span class="p">)</span><span class="w"></span>
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="w">            </span><span class="p">)</span><span class="w"></span>
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="w">        </span><span class="p">)</span><span class="w"></span>
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="w">    </span><span class="p">)</span><span class="w"></span>
</code></pre></div>
<ol>
<li>This is formed according to <a href="../0010-states-channels/#state-commitments">this formula</a>.</li>
<li>This is formed by a simple abi-encode and keccack256 recipe.</li>
</ol>
<h2 id="adjudicator-storage">Adjudicator storage</h2>
<p>Status data is stored inside the adjudicator in the following mapping (with <code>channelId</code> as the key):</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="kt">mapping</span><span class="p">(</span><span class="kt">bytes32</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="kt">bytes32</span><span class="p">)</span><span class="w"> </span><span class="kt">public</span><span class="w"> </span>statusOf<span class="p">;</span><span class="w"></span>
</code></pre></div>
<p>Generating a 32 byte <code>status</code> involves</p>
<ul>
<li>setting the most significant 48 bits to the <code>turnNumRecord</code></li>
<li>setting the next most significant 48 bits to <code>finalizesAt</code></li>
<li>setting the next most significant 160 bits to the <code>fingerprint</code></li>
</ul>
<p>When the adjudicator needs to verify the exact state or outcome, the data is provided in the function arguments, as part of the <code>calldata</code>. The chain will then check that the hydrated data matches the status that has been stored.</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p><code>turnNumRecord</code> and <code>finalizesAt</code> can be read from storage straightforwardly, whereas the other <code>ChannelData</code> fields are only stored as the output of a one-way function. The input to this function must therefore be tracked in client code by monitoring the relevant contract events.</p>
</div>
<p>We provide a helper function to construct the appropriate status from a javascript representation of <code>ChannelData</code>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="w">  </span><span class="nx">ChannelData</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="w">  </span><span class="nx">channelDataToFingerprint</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;@statechannels/nitro-protocol&quot;</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="kd">const</span><span class="w"> </span><span class="nx">channelData</span><span class="o">:</span><span class="w"> </span><span class="kt">ChannelData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="w">  </span><span class="nx">turnNumRecord</span><span class="o">:</span><span class="w"> </span><span class="kt">largestTurnNum</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="w">  </span><span class="nx">finalizesAt</span><span class="o">:</span><span class="w"> </span><span class="kt">0x0</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a><span class="p">};</span><span class="w"></span>
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a><span class="kd">const</span><span class="w"> </span><span class="nx">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">channelDataToStatus</span><span class="p">(</span><span class="nx">channelData</span><span class="p">);</span><span class="w"></span>
</code></pre></div>
<p>Here we omitted some of the fields, because the helper function is smart enough to know to set them to null values when finalizes at is zero.</p>





                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../0030-outcomes/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Outcomes" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Outcomes
            </div>
          </div>
        </a>
      
      
        
        <a href="../0050-precautions-and-limits/" class="md-footer__link md-footer__link--next" aria-label="Next: Precautions and Limits" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Precautions and Limits
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.annotate", "navigation.tracking", "navigation.tabs", "content.tabs.link"], "search": "../../assets/javascripts/workers/search.5bf1dace.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.078830c0.min.js"></script>
      
    
  </body>
</html>